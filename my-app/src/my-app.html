<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">

<link href="https://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet">
<link rel="import" href="my-map.html">
<link rel="import" href="my-list.html">

<dom-module id="my-app">
  <template>
    <style>
      :host {
        --app-primary-color: #4285f4;
        --app-secondary-color: black;

        display: block;
      }

      app-header {
        color: #fff;
        background-color: var(--app-primary-color);
        font-family: 'Inconsolata', monospace;
      }
      app-header paper-icon-button {
        --paper-icon-button-ink-color: white;
      }

      .drawer-list {
        margin: 0 20px;
      }

      .drawer-list a {
        display: block;
        padding: 0 16px;
        text-decoration: none;
        color: var(--app-secondary-color);
        line-height: 40px;
      }

      .drawer-list a.iron-selected {
        color: black;
        font-weight: bold;
      }
    </style>
    <iron-ajax
      auto
      url="https://api.foursquare.com/v2/venues/search?"
      params="{{ajaxParams}}"
      last-response="{{data}}"
      handle-as="json"
      on-response="venuesLoaded"
      >
      </iron-ajax>

    <app-drawer-layout fullbleed>
      <!-- Drawer content -->
      <app-drawer id="drawer">
        <app-toolbar>Menu</app-toolbar>
          <paper-checkbox checked>Arts & Entertainment</paper-checkbox>
          <paper-checkbox checked>Food</paper-checkbox>
          <paper-checkbox checked>Nightlife</paper-checkbox>
          <paper-checkbox checked>Outdoors</paper-checkbox>
          <paper-checkbox checked>Shops</paper-checkbox>

            <my-list data="{{dataCollection}}"></my-list>
      </app-drawer>

      <!-- Main content -->
      <app-header-layout has-scrolling-region>

        <app-header condenses reveals effects="waterfall">
          <app-toolbar>
            <paper-icon-button icon="my-icons:menu" drawer-toggle></paper-icon-button>
            <div main-title>My App</div>
          </app-toolbar>
        </app-header>
        <my-map data="{{dataCollection}}"></my-map>
      </app-header-layout>
    </app-drawer-layout>
  </template>
  <script>
  HTMLImports.whenReady(() => {
    Polymer({
      is: 'my-app',

      properties: {
            client_id: {
                type: String,
                value: '5PHSPJ2ZXMH3JIN1DDOVMIFSLLIS4BOQ4XD2LZE10EFMDH23'
            },
            client_secret: {
                type: String,
                value: 'OHNT2TYCCPXLEMBBH3XZ15VP12O5QB2P31FN4LZYRFA0NKU1'
            },
            v: {
                type: Number,
                value: '20150729'
            },
            limit: {
                type: Number,
                value: '10'
            },
            ll: {
                type: String
            },
            categoryId: {
              type: String,
              value: function(){
                return ['4d4b7104d754a06370d81259', '4d4b7105d754a06374d81259'];
              }
            },
            dataCollection: {
              type: Array,
              notify: true,
              value: function(){
                return [];
              }
            },
            ajaxParams: {
                type: String,
                computed: 'processParams(client_id, client_secret, v, limit, ll, categoryId)'
            }
        },

        attached(){
          getCurrentLat(position => this.ll = position);
        },

        processParams: function(client_id, client_secret, v, limit, ll, categoryId) {
            return {
            client_id: client_id,
            client_secret: client_secret,
            v: v,
            limit:limit,
            ll: ll,
            categoryId: categoryId
          };
        },

        ready: function(data){
          this.dataCollection = [];
        },

        venuesLoaded: function (data) {
          for(var i = 0; i < this.data.response.venues.length; i++){
            console.log(this.data.response.venues[i].name);
            var venueName = this.data.response.venues[i];
            this.push('dataCollection', venueName);
          }
          console.log(this.dataCollection);
        }
    });
});
    function getCurrentLat(callback){
      if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(function(position) {
            callback(position.coords.latitude + ", " + position.coords.longitude);
        });
      }else{
        console.log("Unable to access your geolocation");
      }
    }

  </script>
</dom-module>
