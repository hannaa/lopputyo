<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/mapbox-gl/mapbox-gl.html">
<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.32.1/mapbox-gl.css' rel='stylesheet' />


<dom-module id="my-here">
  <template>
    <style>
      #map{
        height: 100%;
        width: 100%;
      }
      .marker {
    display: block;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    padding: 0;
}
    </style>

  <mapbox-gl id="map"
      map="{{map}}"
      interactive
      map-style={{mapStyle}}
      script-src="https://api.mapbox.com/mapbox-gl-js/v0.32.1/mapbox-gl.js"
      access-token="pk.eyJ1IjoiaGFubmFrYWlzIiwiYSI6ImNpeXN6dnczYjAwMG8ycHBjeW44Y2J6aW0ifQ.nJbgIPU2obZwru8i-9P_0g"
      latitude={{userLatitude}} longitude={{userLongitude}}
      zoom=13 pitch=50
      bearing=0
>
    </mapbox-gl>
    <template is="dom-repeat" items="{{data}}">
      <span>{{item.location.lat}}</span>
    </template>

  </template>

<script>
  HTMLImports.whenReady(() => {
    Polymer({
      is: 'my-here',

     properties: {
        map: {
          type: Object
        },
        userLatitude: {
          type: Number
        },
        userLongitude:{
          type: Number,
        },
        mapStyle: {
          type: Object,
          value: 'mapbox://styles/mapbox/streets-v9'
        },
        addMarker: {
          type: Object,
          computed: '_addUserMarker(map)'
        }
      },

        _addUserMarker: function(map){
          console.log(this.userLatitude);
          var geojson = {
    "type": "FeatureCollection",
    "features": [
        {
            "type": "Feature",
            "properties": {
                "message": "Foo",
                "iconSize": [60, 60],
                "icon": "monument"
            },
            "geometry": {
                "type": "Point",
                "coordinates": [
                    this.userLongitude,
                    this.userLatitude
                ]
            }
        },
        {
            "type": "Feature",
            "properties": {
                "message": "Bar",
                "iconSize": [50, 50]
            },
            "geometry": {
                "type": "Point",
                "coordinates": [
                    24.9375,
                    60.170833
                ]
            }
        }
    ]
};

geojson.features.forEach(function(marker) {
    // create a DOM element for the marker
    var el = document.createElement('div');
    el.className = 'marker';
    //el.style.backgroundImage = 'url(https://placekitten.com/g/' + marker.properties.iconSize.join('/') + '/)';
    el.style.width = marker.properties.iconSize[0] + 'px';
    el.style.height = marker.properties.iconSize[1] + 'px';

    el.addEventListener('click', function() {
        window.alert(marker.properties.message);
    });

    // add marker to map
    new mapboxgl.Marker(el, {offset: [-marker.properties.iconSize[0] / 2, -marker.properties.iconSize[1] / 2]})
        .setLngLat(marker.geometry.coordinates)
        .addTo(map);
});
        }
    });
});
</script>
</dom-module>
